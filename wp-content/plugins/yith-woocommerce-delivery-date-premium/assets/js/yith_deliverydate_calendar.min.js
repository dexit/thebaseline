var get_unique_id=function(e,t){return e===undefined&&(e="_"),t===undefined&&(t=13),e+Math.random().toString(t).substr(2,t)},calendar=jQuery("#ywcdd_general_calendar"),block_params={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},render_calendar=function(){calendar.data("ywcdd_events_json");calendar.fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultDate:ywcdd_calendar_params.starday,locale:ywcdd_calendar_params.calendar_language,aspectRatio:1.8,editable:!1,eventLimit:!0,timeFormat:"H:mm",buttonIcons:!1,navLinks:!0,lazyFetching:!0,showNonCurrentDates:!1,events:function(e,t,a,n){t={action:ywcdd_calendar_params.actions.show_current_month,start_date:e.format(),end_date:t.format()};jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url,data:t,dataType:"json",beforeSend:function(){jQuery("#ywcdd_general_calendar").block(block_params)},success:function(e){n(e)},complete:function(){jQuery("#ywcdd_general_calendar").unblock()}})},eventRender:function(a,e,t){"holiday"==a.event_type&&(e.append("<span class='ywcdd_delete_calendar'></span>"),e.on("click",".ywcdd_delete_calendar",function(e){var t={ywcdd_event_id:a.id,action:ywcdd_calendar_params.actions.delete_calendar_holidays};jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url,data:t,dataType:"json",success:function(e){"deleted"===e.result&&jQuery("#ywcdd_general_calendar").fullCalendar("removeEvents",a.id)}})})),e.find(".fc-title").html(e.find(".fc-title").text())}}),jQuery(".fc-button-group button").addClass("button-primary"),jQuery(".fc-left button.fc-prev-button").html("< "+jQuery(".fc-left button.fc-prev-button").html()),jQuery(".fc-left button.fc-next-button").html(jQuery(".fc-left button.fc-next-button").html()+" >")},getDate=function(e){var t;try{t=$.datepicker.parseDate(ywcdd_calendar_params.dateformat,e.value)}catch(a){console.log(a),t=null}return t},saveHolidayElement=function(t,a){var e=t.serializeToggleElement();jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url+"?action="+ywcdd_calendar_params.actions.add_holidays,data:e,contentType:!1,processData:!1,success:function(e){a&&a.removeClass("show"),e.title&&t.find(".yith-toggle-title .title").html(e.title),e.subtitle&&t.find(".yith-toggle-title .subtitle").html(e.subtitle),calendar.fullCalendar("refetchEvents")}})},updateHolidayElement=function(e,t){e=e.serializeToggleElement();jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url+"?action="+ywcdd_calendar_params.actions.update_holidays,data:e,contentType:!1,processData:!1,success:function(e){t&&t.removeClass("show"),calendar.fullCalendar("refetchEvents")}})},deleteHolidayElement=function(e){e={item_key:e.data("item_key"),action:ywcdd_calendar_params.actions.delete_holidays};jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url,data:e,dataType:"json",beforeSend:function(){jQuery("#ywcdd_general_calendar").block()},success:function(e){e.result;calendar.fullCalendar("refetchEvents")}})},init_datepicker=function(){jQuery(document).find(".ywcdd_datepicker").each(function(){jQuery(this).datepicker("destroy"),jQuery(this).datepicker({dateFormat:ywcdd_calendar_params.dateformat})}),jQuery(document).find(".holiday_from").datepicker("option","minDate",0).on("change",function(){var e=jQuery(this),t=e.parent().parent().parent().find(".holiday_to");""!==e.val()?t.datepicker("option","minDate",getDate(this)):t.datepicker("option","minDate",0)})};jQuery(function(c){c("#yith_delivery_date_panel_general-calendar").length&&(c(document).off("click",".yith-add-box-buttons .yith-save-button"),c(document).off("click",".yith-toggle-row .yith-save-button"),c(document).off("click",".yith-toggle-onoff"),c(document).off("click",".yith-toggle-row .yith-delete-button")),c(document).on("click","#ywcdd_holidays_option_add_box .yith-save-button",function(e){e.preventDefault();var t=c(this).parents(".yith-add-box"),a=c(this).closest(".yith-toggle_wrapper").attr("id"),n=t.find(".spinner"),d=c(this).parents(".toggle-element"),e=t.find(":input"),l=get_unique_id("ywcdd_holiday_"),a=wp.template("yith-toggle-element-item-"+a),i=c(a({index:l}));"yes"===t.checkRequiredFields()&&(n.addClass("show"),c.each(e,function(e,t){void 0!==c(t).attr("id")&&($field_id=c(t).attr("id"),$field_id=$field_id.replace("new_","")+"_"+l,$field_val=c(t).val(),c(i).find("#"+$field_id).val($field_val),c(t).is(":checked")&&c(i).find("#"+$field_id).prop("checked",!0))}),c(document).trigger("yith-toggle-element-item-before-add",[t,i]),d.find(".yith-toggle-row").length?c(i).insertAfter(d.find(".yith-toggle-row").last()):c(i).appendTo(d.find("td")),c(document.body).trigger("wc-enhanced-select-init"),saveHolidayElement(i,n),c(t).toggle(),init_datepicker())}),c(document).on("click","#yith_delivery_date_panel_general-calendar .yith-toggle-row .yith-save-button",function(e){e.preventDefault();c(this).closest(".toggle-element");var t=c(this).closest(".yith-toggle-row"),e=t.find(".spinner");t.checkRequiredFields()&&(e.addClass("show"),updateHolidayElement(t,e))}),c(document).on("click","#yith_delivery_date_panel_general-calendar .yith-toggle-onoff",function(e){e.preventDefault();c(this).closest(".toggle-element");e=c(this).closest(".yith-toggle-row");updateHolidayElement(e)}),c(document).on("click","#yith_delivery_date_panel_general-calendar .yith-toggle-row .yith-delete-button",function(e){e.preventDefault();c(this).closest(".toggle-element");e=c(this).closest(".yith-toggle-row");e.remove(),deleteHolidayElement(e)}),c(document).on("change","#yith_delivery_date_panel_general-calendar :input.yith-required-field",function(e){var t=c(this).val();""===t&&null===t||(c(this).hasClass("wc-enhanced-select")?c(this).parent().find(".select2.select2-container"):c(this)).removeClass("ywcdd_required_field")}),render_calendar(),init_datepicker(),c(document).on("yith-add-box-button-toggle",function(e,t){init_datepicker()})});