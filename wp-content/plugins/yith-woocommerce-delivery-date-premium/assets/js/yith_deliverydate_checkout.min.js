jQuery(function(r){var a="",t=r("#ywcdd_carrier").val(),o=function(){return(1<r(".shipping_method").length?r(".shipping_method:checked"):r(".shipping_method")).val()},c=function(){var e=r(document).find("#ywcdd_process_method").val(),d=r(document).find("#ywcdd_carrier").val(),e={ywcdd_carrier_id:d,ywcdd_process_id:e,action:ywcdd_params.actions.update_datepicker};r(document).find("#ywcdd_datepicker").datepicker("destroy"),""!==d?r.ajax({type:"POST",url:ywcdd_params.ajax_url,data:e,dataType:"json",success:function(e){"undefined"!=typeof e.available_days?r(document).trigger("ywcdd_found_available_days",[e.available_days,d]):r("form.checkout").unblock()}}):(r(document).find(".ywcdd_datepicker_content").hide(),r(document).find(".ywcdd_timeslot_content").hide(),r("form.checkout").unblock())},i={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0};r(document).on("ywcdd_found_available_days",function(e,c,d){var o,t,a,i=r(document).find("#ywcdd_datepicker"),n=i.parents(".ywcdd_datepicker_content");o=c,r.each(o,function(e,d){var t="";try{var c=new Date(1e3*d);c.setTime(c.getTime()+60*(new Date).getTimezoneOffset()*1e3),t=r.datepicker.formatDate(ywcdd_params.dateformat,c),o[e]=t}catch(a){t=null}}),c=o,i.datepicker({dateFormat:ywcdd_params.dateformat,numberOfMonths:+ywcdd_params.numberOfMonths,yearSuffix:ywcdd_params.yearSuffix,beforeShow:function(e,d){r("#ui-datepicker-div").removeClass("yith_datepicker"),r("#ui-datepicker-div").addClass("yith_datepicker"),setTimeout(function(){r("#ui-datepicker-div").show()},0)},beforeShowDay:function(e){var d=c,e=r.datepicker.formatDate(ywcdd_params.dateformat,e);return[-1!==d.indexOf(e)]},onSelect:function(e,d){var t,c,a=d.selectedMonth+1,o=d.selectedDay,o=d.selectedYear+"-"+a+"-"+o;r(document).find(".ywcdd_delivery_date").val(o),t=o,c=r(document).find("#ywcdd_carrier").val(),o={ywcdd_carrier_id:c,ywcdd_date_selected:t,action:ywcdd_params.actions.update_timeslot},r.ajax({type:"POST",url:ywcdd_params.ajax_url,data:o,dataType:"json",success:function(e){e=e.available_timeslot;r(document).trigger("ywcdd_found_time_slots",[e,t,c])}})},onClose:function(e,d){var t=c;void 0!==t&&-1===t.indexOf(e)&&(alert("Error: the date "+e+" isn't available"),i.datepicker("setDate",t[0]),r(".ui-datepicker-current-day").click())}}),void 0!==c&&0<c.length&&(t=c[0],a=c[c.length-1],i.datepicker("option","minDate",t),i.datepicker("option","maxDate",a),"yes"===ywcdd_params.show_the_min_date&&(i.datepicker("setDate",t),r(".ui-datepicker-current-day").click())),n.show(),"yes"===ywcdd_params.open_datepicker&&i.datepicker("show"),r("form.checkout").unblock()}),r(document).on("ywcdd_found_time_slots",function(e,d,t,c){var a=r(document).find(".ywcdd_timeslot_content"),o=a.find("#ywcdd_timeslot"),i=a.find(".ywcdd_timeslot_av");o.find("option").not("[value='']").remove(),r.isEmptyObject(d)?(i.val("no"),a.hide()):(r.each(d,function(e,d){o.append(r("<option></option>").attr("value",e).html(d))}),a.show(),i.val("yes")),o.select2(),o.trigger("change"),r("form.checkout").unblock()}),r("form.checkout").on("change","#ywcdd_timeslot",function(e){e.originalEvent!==undefined&&r("form.checkout").block(i),r("body").trigger("update_checkout")}).on("change","#ywcdd_carrier",function(e){var d=r(this).val();d!==t&&(t=d,r("form.checkout").block(i),c())}),r(document.body).on("updated_checkout",function(e,d){var t,c;t=r(document).find("#ywcdd_process_method").val(),c=o(),t={ywcdd_update_carrier:"update_carrier",ywcdd_shipping_id:c,ywcdd_process_method:t,action:ywcdd_params.actions.update_carrier_list},a!==c?r.ajax({type:"POST",url:ywcdd_params.ajax_url,data:t,dataType:"json",success:function(e){e.update_delivery_form&&(""!==e.template?r(".ywcdd_select_delivery_date_content").replaceWith(e.template):r(".ywcdd_select_delivery_date_content").html(""),r("body").trigger("init-delivery-fields"))}}):r("form.checkout").unblock()}),r(document).on("init-delivery-fields",function(e){r("form.checkout").block(i),a=o(),r(document).find("#ywcdd_carrier").select2(),c()}).trigger("init-delivery-fields"),r("body").on("update_checkout",function(){r("form.checkout").block(i)})});